---
description: Core jPulse framework assistant rules (no git, no guessing, formatting)
alwaysApply: true
---

# ⛔ CRITICAL: NO GIT COMMANDS EVER WITHOUT EXPLICIT APPROVAL ⛔

**NEVER run: git status, git log, git show, git diff, git add, git commit, git push, git pull, etc.**

**ALWAYS ask first: "May I run git commands to check X?"**

# Framework Critical Patterns

1. **Site Override System**: All site code goes in `site/webapp/`, NEVER modify `webapp/` (framework-managed, updated by jpulse-update)

2. **CSS Prefix Rules** (CRITICAL):
   - `local-*` = Page-specific styles in `<style>` tags within view files
   - `site-*` = Shared site styles in `site/webapp/view/jpulse-common.css`
   - `jp-*` = Framework only (read-only, never create or modify)
   - Use existing `jp-*` classes from framework, see webapp/static/assets/jpulse-docs/style-reference.md

3. **Theme-Aware Development**:
   - ALWAYS use `--jp-theme-*` CSS variables for colors (never hard-code `#RRGGBB`, `rgb()`, `hsl()`)
   - Use `{{appConfig.system.htmlAttrs}}` for `<html>` tag (includes `lang` and `data-theme`)
   - Framework provides 49+ theme variables for all UI elements

4. **API-First Development**: All data operations use `/api/1/*` REST endpoints
   - Client-side JavaScript calls APIs for data (jPulse.api.get/post/put/delete)
   - Server-side only renders initial page structure (skeleton HTML)
   - The V in MVC resides in the browser for application pages

5. **Controller Auto-Discovery**: Controllers auto-register via `static async api*()` methods
   - Never manually register routes in routes.js
   - Method naming convention determines HTTP method and endpoint
   - Pattern: apiCreate, apiUpdate, apiDelete, apiCustomName

6. **Logging Requirements**: Every user-facing action requires logging
   - Initial: `LogController.logRequest(req, 'controller.method', 'description')`
   - Success: `LogController.logInfo(req, 'controller.method', 'success: description')`
   - Error: `LogController.logError(req, 'controller.method', 'error: ' + error.message)`
   - Format: `[controller].[method]` for all log messages

7. **ISO Date Format**: Always use YYYY-MM-DD via `jPulse.date.formatLocalDate()`
   - Never use browser's toLocaleDateString() or localized formats
   - For date+time: `jPulse.date.formatLocalDateAndTime()`

8. **JavaScript Conventions**:
   - Use framework utilities from `webapp/view/jpulse-common.js` (read-only, jPulse.* methods)
   - Create site utilities in `site/webapp/view/jpulse-common.js` if needed (appended, optional)
   - Never modify `webapp/view/jpulse-common.js` (framework-managed)

9. **Reference Implementations** (study these before creating new code):
   - Model: `site/webapp/model/helloTodo.js`
   - Controller: `site/webapp/controller/helloTodo.js`
   - View: `site/webapp/view/hello-todo/index.shtml`
   - Admin UI: `webapp/view/admin/logs.shtml`

10. **File Resolution Priority** (automatic):
    - 1st: `site/webapp/[path]` (site overrides, highest priority)
    - 2nd: `plugins/[name]/webapp/[path]` (plugin files)
    - 3rd: `webapp/[path]` (framework defaults)

11. **Page Structure**:
    - Use `jPulse.dom.ready()` instead of `DOMContentLoaded`
    - Include framework templates: `{{file.include "jpulse-header.tmpl"}}`
    - Load data client-side with jPulse.api calls (for application pages)

12. **Breadcrumbs**: Auto-generated by framework, placed as first child of `<body>`
    - NEVER manually code breadcrumbs inside `jp-main`
    - Configured via navigation structure in `jpulse-navigation.js`
    - Framework handles placement and styling automatically

13. **Error Handling**: All API endpoints need try-catch
    - Use `CommonUtils.sendError()` for standardized error responses
    - Return JSON: `{ success: true/false, data/error }`
    - Never leak sensitive information in error messages

14. **Code Formatting** (enforced):
    - No tabs - always 4 spaces for indentation
    - No trailing spaces or spaces on blank lines (violations caught by `/ +$/` regex)
    - Proper indentation consistency

15. **Documentation Sources** (read before implementing):
    - Gen-AI Instructions: `webapp/static/assets/jpulse-docs/genai-instructions.md` (768 lines, comprehensive)
    - Style Reference: `webapp/static/assets/jpulse-docs/style-reference.md`
    - Front-End Development: `webapp/static/assets/jpulse-docs/front-end-development.md`
    - API Reference: `webapp/static/assets/jpulse-docs/api-reference.md`

# jPulse Framework - Core Assistant Rules

- Do not guess or hallucinate. If context is missing, use the transcript file the user provided, or say “I don’t know” / “I am not sure, but I can look it up if you’d like”.
- Follow source formatting preferences:
    - No tabs in source; use spaces only.
    - Prefer 4 spaces for indentation.
    - No spaces on empty lines (avoid lines matching `^ +$`).

# Session Hygiene

- If the user provides a transcript path, consult it for missing details instead of guessing.

# Debugging Approach

When investigating bugs, follow this workflow:

1. **Understand the architecture FIRST**
   - Read relevant source files completely
   - Use SemanticSearch to find how the feature is designed to work
   - Use Grep to find similar working examples in the codebase

2. **Compare and contrast**
   - If "this used to work", find what changed (git diff, recent commits)
   - Compare broken implementation with working examples
   - Identify architectural or structural mismatches

3. **Root cause before fixes**
   - NEVER propose ANY fix before understanding root cause
   - Explain "why it broke" before explaining "how to fix"
   - If understanding is incomplete, explicitly ask for more investigation time

4. **No trial-and-error**
   - NEVER try multiple random fixes hoping one works
   - NEVER apply CSS/style overrides without understanding layout architecture
   - Each proposed fix must be based on architectural understanding

5. **Verification**
   - Proposed fix should address the root cause, not symptoms
   - Explain how the fix aligns with the framework's design patterns
