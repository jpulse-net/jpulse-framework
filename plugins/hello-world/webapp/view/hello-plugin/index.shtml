<!DOCTYPE html>
<!--
 * @name            jPulse Framework / Plugins / Hello World / WebApp / View / Hello Plugin / Index
 * @tagline         Interactive Plugin Development Tutorial
 * @description     Educational demo showing how plugins work in jPulse Framework
 * @file            plugins/hello-world/webapp/view/hello-plugin/index.shtml
 * @version         1.3.14
 * @release         2025-12-13
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 2.0, Claude Sonnet 4.5
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World Plugin Tutorial - {{app.site.shortName}}</title>
{{file.include "jpulse-header.tmpl"}}
    <style>
    /* Demo card grid (unique to this tutorial page) */
    .local-demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .local-demo-card {
        padding: 20px;
        border: 2px solid rgb(226, 232, 240);
        border-radius: 8px;
        text-align: center;
        transition: transform 0.2s, box-shadow 0.2s;
        background: white;
    }

    .local-demo-card:hover {
        transform: translateY(-2px);
        box-shadow: rgba(0, 0, 0, 0.08) 0px 1px 3px;
    }

    .local-demo-icon {
        font-size: 2em;
        margin-bottom: 10px;
    }

    .local-demo-card h4 {
        margin: 10px 0 5px 0;
        font-size: 1.1em;
    }

    .local-demo-card p {
        margin: 0;
        font-size: 0.9em;
    }

    /* Output state colors (extends jp-info-box) */
    .jp-info-box.local-output-success {
        background: #e8f5e9;
        border-left-color: #4caf50;
    }

    .jp-info-box.local-output-error {
        background: #ffebee;
        border-left-color: #f44336;
    }
    </style>
</head>
<body>
    {{#component "helloCards.helloPlugin" order=60}}
        {{!-- This card is automatically included in the dashboard at hello/index.shtml --}}
        <a href="/hello-plugin/" class="jp-card-dashboard jp-icon-btn">
            <div class="jp-icon-container">üîå</div>
            <h3 class="jp-card-title">Hello World Plugin</h3>
            <p class="jp-card-description">
                Learn plugin development with this interactive tutorial
            </p>
        </a>
    {{/component}}

    <div class="jp-main">
        <div class="jp-container-1000">
            <div class="jp-page-header">
                <h1>üîå Hello World Plugin Tutorial</h1>
                <span class="jp-subtitle">Interactive demonstration of the jPulse plugin system</span>
            </div>

            <div class="jp-alert jp-alert-info">
                <strong>üéì Learning Objective:</strong> This page demonstrates how plugins extend the jPulse Framework.
                Each section shows a different aspect of plugin development with working code examples.
            </div>

            <!-- Section 1: Plugin CSS -->
            <div class="jp-card">
                <h2>üé® Section 1: Plugin-Specific CSS Styling</h2>
                <p>
                    This demo uses <code>local-*</code> prefixed styles (defined in this page's &lt;style&gt; section).
                    For global plugin styles used across multiple pages, use <code>plg-{plugin-name}-*</code> prefix
                    in <code>plugins/hello-world/webapp/view/jpulse-common.css</code> (automatically appended to framework CSS).
                </p>

                <h3>Custom Plugin Styles:</h3>
                <div class="local-demo-grid">
                    <div class="local-demo-card">
                        <div class="local-demo-icon">üéØ</div>
                        <h4>Namespaced CSS</h4>
                        <p>Uses <code>.plg-hello-world-*</code> prefix</p>
                    </div>
                    <div class="local-demo-card">
                        <div class="local-demo-icon">üì¶</div>
                        <h4>Auto-Appended</h4>
                        <p>Automatically loaded with framework CSS</p>
                    </div>
                    <div class="local-demo-card">
                        <div class="local-demo-icon">‚ú®</div>
                        <h4>No Conflicts</h4>
                        <p>Plugin prefix prevents name collisions</p>
                    </div>
                </div>

                <div id="css-code-collapsible" class="jp-collapsible">
                    <h3>üíª View CSS Code</h3>
                    <div class="jp-collapsible-content">
                        <p>File: <code>plugins/hello-world/webapp/view/hello-plugin/index.shtml</code></p>
                        <div class="jp-source-code" data-lang="css">
/* This page uses local styles (not global) */

.local-demo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.local-demo-card {
    padding: 20px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    text-align: center;
}

.local-demo-icon {
    font-size: 2em;
    margin-bottom: 10px;
}

/* For global styles, use: plugins/hello-world/webapp/view/jpulse-common.css */
/* Prefix: .plg-hello-world-* (available site-wide, automatically loaded) */</div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Plugin JavaScript -->
            <div class="jp-card">
                <h2>‚ö° Section 2: Plugin JavaScript Extensions</h2>
                <p>
                    Plugin JavaScript lives under <code>window.jPulse.plugins.{pluginName}</code> namespace.
                    This prevents global namespace pollution and allows plugins to coexist.
                </p>

                <h3>Plugin Utility Functions:</h3>
                <button class="jp-btn jp-btn-primary" onclick="testPluginUtils()">
                    Test Plugin Utilities
                </button>

                <div id="pluginUtilsOutput" class="jp-info-box" style="margin-top: 15px;">
                    Click the button to test plugin JavaScript functions...
                </div>

                <div id="js-code-collapsible" class="jp-collapsible">
                    <h3>üíª View JavaScript Code</h3>
                    <div class="jp-collapsible-content">
                        <p>File: <code>plugins/hello-world/webapp/view/jpulse-common.js</code></p>
                        <div class="jp-source-code" data-lang="js">
// Ensure plugin namespace exists
window.jPulse.plugins.helloWorld = {
    greet: function(name) {
        return `Hello, ${name}! üîå`;
    },

    getTimestamp: function() {
        return new Date().toISOString();
    },

    calculateSum: function(a, b) {
        return a + b;
    }
};</div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Plugin API Integration -->
            <div class="jp-card">
                <h2>üì° Section 3: Plugin REST API</h2>
                <p>
                    Plugins can provide their own REST API endpoints following jPulse conventions.
                    Controllers use <code>static async api*()</code> methods for auto-discovery.
                </p>

                <h3>Test Plugin API:</h3>
                <button class="jp-btn jp-btn-primary" onclick="testPluginAPI()">
                    GET /api/1/helloPlugin
                </button>

                <div id="apiOutput" class="jp-info-box" style="margin-top: 15px;">
                    Click the button to call the plugin's API endpoint...
                </div>

                <div id="api-code-collapsible" class="jp-collapsible">
                    <h3>üíª View Controller Code</h3>
                    <div class="jp-collapsible-content">
                        <p>File: <code>plugins/hello-world/webapp/controller/helloPlugin.js</code></p>
                        <div class="jp-source-code" data-lang="js">
export default class HelloPluginController {
    static async apiGet(req, res) {
        // Auto-discovered and registered at /api/1/helloPlugin
        return res.json({
            success: true,
            data: {
                message: 'Hello from plugin!',
                timestamp: new Date().toISOString(),
                version: '1.0.0'
            }
        });
    }
}</div>
                    </div>
                </div>
            </div>

            <!-- Section 4: Plugin Information & Configuration -->
            <div class="jp-card">
                <h2>‚öôÔ∏è Section 4: Plugin Information & Configuration</h2>
                <p>
                    Plugins can define configuration schemas in <code>plugin.json</code>.
                    The framework automatically generates admin UI and stores config in MongoDB.
                </p>

                <h3>Plugin Information (Public API):</h3>
                <button class="jp-btn jp-btn-primary" onclick="loadPluginConfig()">
                    Load Plugin Info
                </button>

                <div id="configOutput" class="jp-info-box" style="margin-top: 15px;">
                    Click the button to load public plugin information via <code>/api/1/plugin/hello-world/info</code>
                </div>

                <p style="margin-top: 20px;">
                    <strong>Configuration Management:</strong><br>
                    <a href="/admin/plugin-config.shtml?plugin=hello-world" class="jp-btn jp-btn-secondary" style="margin-top: 10px;">
                        ‚öôÔ∏è Configure Plugin Settings
                    </a>
                    <span style="font-size: 0.9em; margin-left: 10px;">
                        (only available to administrators)
                    </span>
                </p>

                <div id="config-schema-collapsible" class="jp-collapsible">
                    <h3>üíª View Configuration Schema</h3>
                    <div class="jp-collapsible-content">
                        <p>File: <code>plugins/hello-world/plugin.json</code></p>
                        <div class="jp-source-code" data-lang="json">
{
    "config": {
        "schema": [
            {
                "id": "message",
                "label": "Welcome Message",
                "type": "text",
                "default": "Hello from the plugin system!",
                "help": "This message will be displayed",
                "tab": "General"
            },
            {
                "id": "showStats",
                "label": "Show Statistics",
                "type": "boolean",
                "default": true,
                "tab": "General"
            }
        ]
    }
}</div>
                    </div>
                </div>
            </div>

            <!-- Section 5: Automatic Asset Loading -->
            <div class="jp-card">
                <h2>üì¶ Section 5: Automatic Asset Loading</h2>
                <p>
                    Plugin CSS and JavaScript files are automatically loaded with the framework.
                    This provides better performance (fewer HTTP requests) and guaranteed load order.
                </p>

                <h3>How It Works:</h3>
                <ol style="line-height: 1.8;">
                    <li><strong>Framework processes requests</strong> for <code>/common/jpulse-common.css</code> and <code>/common/jpulse-common.js</code></li>
                    <li><strong>PathResolver collects all matching files</strong> from framework ‚Üí site ‚Üí plugins</li>
                    <li><strong>Files are concatenated</strong> in load order with proper separation</li>
                    <li><strong>Result is cached</strong> for performance (with cache busting via query params)</li>
                    <li><strong>Browser receives single file</strong> containing framework + site + all plugin code</li>
                </ol>

                <h3 style="margin-top: 20px;">Files That Are Auto-Loaded:</h3>
                <ul style="line-height: 1.8;">
                    <li><code>webapp/view/jpulse-common.css</code> ‚Üí Plugin CSS styles</li>
                    <li><code>webapp/view/jpulse-common.js</code> ‚Üí Plugin JavaScript utilities</li>
                    <li><code>webapp/view/jpulse-navigation.js</code> ‚Üí Navigation menu entries</li>
                </ul>

                <div class="jp-alert jp-alert-info">
                    <strong>üí° Tip:</strong> Plugins can still use <code>webapp/static/</code> for standalone assets
                    that shouldn't be appended (like images, large libraries, or dynamically loaded scripts).
                </div>
            </div>

            <!-- Navigation Links -->
            <div class="jp-card">
                <h2>üìö Learn More</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <a href="/jpulse-plugins/hello-world.shtml" class="jp-btn jp-btn-primary">
                        Plugin Overview
                    </a>
                    {{#if user.isAdmin}}
                    <a href="/admin/plugin-config.shtml?plugin=hello-world" class="jp-btn jp-btn-secondary">
                        Configure Plugin
                    </a>
                    {{/if}}
                    <a href="/jpulse-docs/installed-plugins/hello-world/README" class="jp-btn jp-btn-secondary" target="_blank">
                        Plugin Docs
                    </a>
                    <a href="/jpulse-docs/plugins/README" class="jp-btn jp-btn-secondary" target="_blank">
                        Developer Guide
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
    /**
     * Interactive demo functions for testing plugin features
     */

    // Initialize collapsibles
    jPulse.dom.ready(() => {
        jPulse.UI.collapsible.register('css-code-collapsible', { initOpen: false });
        jPulse.UI.collapsible.register('js-code-collapsible', { initOpen: false });
        jPulse.UI.collapsible.register('api-code-collapsible', { initOpen: false });
        jPulse.UI.collapsible.register('config-schema-collapsible', { initOpen: false });
    });

    // Test plugin JavaScript utilities
    function testPluginUtils() {
        const output = document.getElementById('pluginUtilsOutput');
        output.classList.remove('local-output-success', 'local-output-error');

        try {
            const greeting = window.jPulse.plugins.helloWorld.greet('Developer');
            const timestamp = window.jPulse.plugins.helloWorld.getTimestamp();
            const sum = window.jPulse.plugins.helloWorld.calculateSum(42, 8);

            output.classList.add('local-output-success');
            output.innerHTML = `
                <strong>‚úì Success!</strong> Plugin utilities are working:<br><br>
                <strong>greet('Developer'):</strong> ${greeting}<br>
                <strong>getTimestamp():</strong> ${timestamp}<br>
                <strong>calculateSum(42, 8):</strong> ${sum}
            `;
        } catch (error) {
            output.classList.add('local-output-error');
            output.innerHTML = `<strong>‚úó Error:</strong> ${error.message}`;
        }
    }

    // Test plugin API endpoint
    async function testPluginAPI() {
        const output = document.getElementById('apiOutput');
        output.classList.remove('local-output-success', 'local-output-error');
        output.innerHTML = '<pre style="margin: 0;">Loading...</pre>';

        try {
            const response = await jPulse.api.get('/api/1/helloPlugin');
            output.classList.add('local-output-success');
            output.innerHTML = `<pre style="margin: 0;">${JSON.stringify(response, null, 2)}</pre>`;
        } catch (error) {
            output.classList.add('local-output-error');
            output.innerHTML = `<strong>Error:</strong> ${error.message}`;
        }
    }

    // Load plugin information (public endpoint)
    async function loadPluginConfig() {
        const output = document.getElementById('configOutput');
        output.classList.remove('local-output-success', 'local-output-error');
        output.innerHTML = '<em>Loading...</em>';

        try {
            const response = await jPulse.api.get('/api/1/plugin/hello-world/info');

            if (response.success) {
                const info = response.data;
                output.classList.add('local-output-success');
                output.innerHTML = `
                    <strong>Plugin Information:</strong><br><br>
                    <strong>Name:</strong> ${jPulse.string.escapeHtml(info.name)}<br>
                    <strong>Version:</strong> ${jPulse.string.escapeHtml(info.version)}<br>
                    <strong>Status:</strong> ${info.enabled ? '<span class="jp-status-badge jp-status-active">Active</span>' : '<span class="jp-status-badge jp-status-disabled">Disabled</span>'}<br>
                    <strong>Auto-Enable:</strong> ${info.autoEnable ? 'Yes ‚úì' : 'No ‚úó'}<br>
                    <strong>Author:</strong> ${jPulse.string.escapeHtml(info.author)}
                `;
            } else {
                output.classList.add('local-output-error');
                output.innerHTML = `<em>Error: ${response.error || 'Failed to load plugin information'}</em>`;
            }
        } catch (error) {
            output.classList.add('local-output-error');
            output.innerHTML = `<em>Error: ${error.message}</em>`;
        }
    }
    </script>

    {{file.include "jpulse-footer.tmpl"}}
</body>
</html>
