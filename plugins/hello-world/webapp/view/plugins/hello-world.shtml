<!DOCTYPE html>
<!--
 * @name            jPulse Framework / Plugins / Hello World / WebApp / View / Plugins / Hello World
 * @tagline         Hello World Plugin details page for jPulse Framework
 * @description     Hello World Plugin details page for jPulse Framework
 * @file            plugins/hello-world/webapp/view/plugins/hello-world.shtml
 * @version         1.2.6
 * @release         2025-11-25
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 2.0, Claude Sonnet 4.5
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World Plugin Details - {{app.site.shortName}}</title>
{{file.include "jpulse-header.tmpl"}}
</head>
<body>
    <div style="display: none;">
        <!-- This card is automatically included in the plugins dashboard at /plugins/ -->
        <!-- extract:start order=10 -->
        <a href="/plugins/hello-world.shtml" class="jp-card-dashboard jp-icon-btn">
            <div class="jp-icon-container">üëã</div>
            <h3 class="jp-card-title">Hello World Plugin</h3>
            <p class="jp-card-description">
                Demonstrates the jPulse plugin system with API endpoints, views, and configuration management.
            </p>
        </a>
        <!-- extract:end -->
    </div>

    <div class="jp-main">
        <div class="jp-page-header">
            <h1><span style="font-size: 26px; margin-right: 8px;">üëã</span> Hello World Plugin</h1>
            <div class="jp-subtitle" style="display: flex; align-items: center; gap: 15px;">
                <span id="plugin-version">Version 1.0.0</span>
                &nbsp;
                <span id="plugin-status" class="plg-status-badge plg-status-active">Active</span>
            </div>
        </div>

        <!-- Two-column layout for main content -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
            <!-- Left Column: Configuration -->
            <div class="jp-card">
                <h2 class="jp-card-dialog-heading">Configuration</h2>
                <div class="jp-card-subheading">Customize the plugin's behavior</div>

                <form id="pluginConfigForm" class="jp-form" style="margin-top: 20px;">
                    <div class="jp-form-group">
                        <label for="message" class="jp-form-label">Welcome Message</label>
                        <input type="text" id="message" name="message"
                            value=""
                            class="jp-form-input"
                            placeholder="Enter a custom welcome message"
                            style="width: 100%;">
                        <span class="jp-form-help">
                            This message will be displayed on the Hello World page
                        </span>
                    </div>

                    <div class="jp-form-group">
                        <label class="jp-checkbox-label">
                            <input type="checkbox" id="enabled" name="enabled">
                            Show welcome message
                        </label>
                    </div>

                    <div class="jp-form-actions">
                        <button type="submit" class="jp-btn jp-btn-primary">
                            Save Configuration
                        </button>
                        <button type="button" class="jp-btn jp-btn-secondary"
                                onclick="location.reload()">
                            Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Right Column: Status & Quick Links -->
            <div>
                <!-- Status & Statistics -->
                <div class="jp-card" style="margin-bottom: 20px;">
                    <h2 class="jp-card-dialog-heading">Status & Statistics</h2>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                            <span style="color: #666;">API Status</span>
                            <span id="detail-api-status" style="font-weight: 500;">Loading...</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0;">
                            <span style="color: #666;">Last Request</span>
                            <span id="detail-last-request" style="font-weight: 500;">Loading...</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span style="color: #666;">Total API Calls</span>
                            <span id="detail-total-requests" style="font-weight: 500;">-</span>
                        </div>
                    </div>
                    <div class="jp-form-help" style="margin-top: 10px;">
                        Total API calls to /api/1/helloPlugin endpoints since last restart
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="jp-card">
                    <h2 class="jp-card-dialog-heading">Quick Links</h2>
                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                        <a href="/plugins/" class="jp-btn jp-btn-secondary" style="width: 100%; text-align: center;">
                            ‚Üê Plugins Dashboard
                        </a>
                        <a href="/hello-plugin/" class="jp-btn jp-btn-primary" style="width: 100%; text-align: center;">
                            Open Plugin Page ‚Üí
                        </a>
                        <a href="/jpulse-docs/installed-plugins/hello-world/README" class="jp-btn jp-btn-secondary" target="_blank"
                           style="width: 100%; text-align: center;">
                            üìñ Documentation
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Load detailed stats and configuration (only on detail page)
    if (window.location.pathname === '/plugins/hello-world.shtml') {
        jPulse.dom.ready(async () => {
            try {
                // Load plugin metadata
                const pluginResponse = await jPulse.api.get('/api/1/plugin/hello-world');
                if (pluginResponse.success && pluginResponse.data) {
                    const plugin = pluginResponse.data;
                    document.getElementById('plugin-version').textContent = `Version ${plugin.version}`;
                    document.getElementById('plugin-status').textContent =
                        plugin.enabled ? 'Active' : 'Disabled';
                    document.getElementById('plugin-status').className =
                        plugin.enabled ? 'plg-status-badge plg-status-active' : 'plg-status-badge plg-status-disabled';
                }

                // Load current configuration
                const configResponse = await jPulse.api.get('/api/1/plugin/hello-world/config');
                if (configResponse.success && configResponse.data) {
                    document.getElementById('message').value =
                        configResponse.data.values?.message || 'Hello from the plugin system!';
                    document.getElementById('enabled').checked =
                        configResponse.data.values?.enabled !== false;
                }

                // Load detailed stats
                const statsResponse = await jPulse.api.get('/api/1/helloPlugin/stats');
                if (statsResponse.success) {
                    document.getElementById('detail-api-status').textContent = 'Connected';
                    document.getElementById('detail-last-request').textContent =
                        jPulse.date.formatLocalDateAndTime(new Date());
                    document.getElementById('detail-total-requests').textContent =
                        statsResponse.data.requestCount || '0';
                }

                // Setup form submission - manual handling to ensure correct data types
                const form = document.getElementById('pluginConfigForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    try {
                        // Build config with correct data types
                        const payload = {
                            config: {
                                message: document.getElementById('message').value,
                                enabled: document.getElementById('enabled').checked // Boolean!
                            }
                        };

                        const response = await jPulse.api.put('/api/1/plugin/hello-world/config', payload);

                        if (response.success) {
                            jPulse.UI.toast.success('Configuration saved successfully');
                        } else {
                            jPulse.UI.toast.error(response.message || 'Failed to save configuration');
                        }
                    } catch (error) {
                        console.error('Error saving configuration:', error);
                        jPulse.UI.toast.error('Failed to save configuration');
                    }
                });
            } catch (error) {
                console.error('Error loading Hello World plugin detail:', error);
                jPulse.UI.toast.error('Failed to load plugin details');
            }
        });
    }
    </script>

{{file.include "jpulse-footer.tmpl"}}
</body>
</html>
