<!DOCTYPE html>
<!--
 * @name            jPulse Framework / Site / WebApp / View / Hello To-Do / Architecture
 * @tagline         Architecture Overview of To-Do MVC Demo
 * @description     How Model, View, and Controller components connect
 * @file            site/webapp/view/hello-todo/architecture.shtml
 * @version         1.4.3
 * @release         2026-01-03
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 1.7, Claude Sonnet 4
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do MVC Demo - Architecture - {{app.site.shortName}}</title>
    {{file.include "jpulse-header.tmpl"}}
    <style>
        .local-flow-diagram {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            font-family: monospace;
            line-height: 1.8;
        }

        .local-flow-step {
            margin: 0.5rem 0;
            padding-left: 1rem;
        }

        .local-flow-arrow {
            color: #007acc;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="jp-main">
        <div class="jp-container-1000">
            <div class="jp-page-header">
                <h1>üìã To-Do MVC Demo</h1>
            </div>

            <!-- Sub-navigation -->
            <nav class="jp-btn-nav-group">
                <a href="/hello-todo/" class="jp-btn jp-btn-outline">üìñ Overview</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/todo-app.shtml" class="jp-btn jp-btn-outline">‚úÖ To-Do App</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/code-examples.shtml" class="jp-btn jp-btn-outline">üíª Code Examples</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/architecture.shtml" class="jp-btn jp-btn-outline jp-btn-active">üèóÔ∏è Architecture</a>
            </nav>

            <div class="jp-card">
                <h2 class="jp-card-dialog-heading">üèóÔ∏è MVC Architecture</h2>

                <div class="jp-info-box">
                    <p>Understanding how the Model, View, and Controller work together in jPulse MPA (Hybrid) architecture. The server provides HTML scaffolding and REST APIs, while browser JavaScript handles rendering and DOM updates.</p>
                </div>

                <h3>üìã Initial Page Load Flow</h3>
                <p>Here's what happens when a user first visits the to-do app:</p>

                <div class="local-flow-diagram">
                    <div class="local-flow-step">
                        <strong>1. Browser (Client)</strong><br>
                        User visits: <code>/hello-todo/todo-app.shtml</code><br>
                        Browser requests the page from server
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>2. Server (View Controller)</strong><br>
                        Server renders HTML scaffolding (page structure)<br>
                        <strong>No todos data yet</strong> - just empty containers and JavaScript
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>3. Browser</strong><br>
                        Receives HTML page with embedded JavaScript<br>
                        Page structure loads, JavaScript executes<br>
                        <code>HelloTodoApp.init()</code> runs automatically
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>4. Browser JavaScript</strong><br>
                        Calls API: <code>jPulse.api.call('/api/1/helloTodo')</code><br>
                        Fetches todos data from server
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>5. Controller ‚Üí Model</strong><br>
                        Controller calls <code>HelloTodoModel.findAll()</code><br>
                        Model queries MongoDB and returns todos array
                    </div>
                    <div class="local-flow-arrow">‚Üë</div>
                    <div class="local-flow-step">
                        <strong>6. Controller ‚Üí Browser</strong><br>
                        Controller returns JSON: <code>{ success: true, data: todos }</code>
                    </div>
                    <div class="local-flow-arrow">‚Üë</div>
                    <div class="local-flow-step">
                        <strong>7. Browser JavaScript</strong><br>
                        Receives JSON data<br>
                        Calls <code>renderTodos()</code> to update DOM<br>
                        Todos appear in the list
                    </div>
                </div>

                <h3>üìã User Action Flow (Adding a To-Do)</h3>
                <p>Here's what happens when a user adds a new to-do:</p>

                <div class="local-flow-diagram">
                    <div class="local-flow-step">
                        <strong>1. Browser (Client)</strong><br>
                        User types "Buy milk" and clicks "Add To-Do"<br>
                        JavaScript calls: <code>jPulse.api.post('/api/1/helloTodo', { title: 'Buy milk' })</code>
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>2. Router (routes.js)</strong><br>
                        Receives: <code>POST /api/1/helloTodo</code><br>
                        Routes to: <code>HelloTodoController.apiCreate()</code>
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>3. Controller (helloTodo.js)</strong><br>
                        ‚Ä¢ Extracts data from request: <code>req.body.title</code><br>
                        ‚Ä¢ Gets user info: <code>req.session.user</code><br>
                        ‚Ä¢ Calls Model: <code>HelloTodoModel.create(todoData)</code>
                    </div>
                    <div class="local-flow-arrow">‚Üì</div>
                    <div class="local-flow-step">
                        <strong>4. Model (model/helloTodo.js)</strong><br>
                        ‚Ä¢ Creates todo object with defaults<br>
                        ‚Ä¢ Inserts into MongoDB: <code>collection.insertOne(todo)</code><br>
                        ‚Ä¢ Returns created todo with _id
                    </div>
                    <div class="local-flow-arrow">‚Üë</div>
                    <div class="local-flow-step">
                        <strong>5. Controller</strong><br>
                        ‚Ä¢ Receives todo from Model<br>
                        ‚Ä¢ Sends JSON response: <code>res.json({ success: true, data: todo })</code>
                    </div>
                    <div class="local-flow-arrow">‚Üë</div>
                    <div class="local-flow-step">
                        <strong>6. Browser</strong><br>
                        ‚Ä¢ Receives success response<br>
                        ‚Ä¢ Reloads page: <code>location.reload()</code><br>
                        ‚Ä¢ New todo appears in list
                    </div>
                </div>

                <h3>üìÅ File Structure</h3>
                <div class="jp-source-code">
                    <pre>site/webapp/
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îî‚îÄ‚îÄ helloTodo.js          # Controller: Request handling & coordination
‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îî‚îÄ‚îÄ helloTodo.js          # Model: Database operations
‚îî‚îÄ‚îÄ view/
    ‚îî‚îÄ‚îÄ hello-todo/
        ‚îú‚îÄ‚îÄ index.shtml        # Overview page
        ‚îú‚îÄ‚îÄ todo-app.shtml     # Main app (View template)
        ‚îú‚îÄ‚îÄ code-examples.shtml
        ‚îî‚îÄ‚îÄ architecture.shtml</pre>
                </div>

                <h3>üîÑ Data Flow Patterns</h3>

                <div class="jp-card" style="background: #e3f2fd; border-left: 4px solid #2196f3;">
                    <h4 style="margin-top: 0;">Page Load (jPulse MPA Hybrid)</h4>
                    <p><strong>Request:</strong> User visits <code>/hello-todo/todo-app.shtml</code></p>
                    <ol>
                        <li>Server renders HTML scaffolding (page structure, empty containers)</li>
                        <li>Browser loads page with embedded JavaScript</li>
                        <li>JavaScript automatically calls <code>jPulse.api.call('/api/1/helloTodo')</code></li>
                        <li>Controller returns JSON data from Model</li>
                        <li>JavaScript renders todos into DOM using <code>renderTodos()</code></li>
                    </ol>
                    <p class="jp-help-text">üí° <strong>Key difference:</strong> Server sends structure only, browser fetches and renders data!</p>
                </div>

                <div class="jp-card" style="background: #f3e5f5; border-left: 4px solid #9c27b0;">
                    <h4 style="margin-top: 0;">API Request (User Action)</h4>
                    <p><strong>Request:</strong> User clicks "Add To-Do" button</p>
                    <ol>
                        <li>JavaScript makes AJAX POST to <code>/api/1/helloTodo</code></li>
                        <li>Controller receives JSON, calls Model</li>
                        <li>Model creates todo in MongoDB</li>
                        <li>Controller returns JSON response</li>
                        <li>JavaScript reloads page: <code>location.reload()</code></li>
                        <li>Page reload triggers initial load flow above, showing new todo</li>
                    </ol>
                </div>

                <h3>üéØ Key Design Principles</h3>

                <table class="jp-table">
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Responsibility</th>
                            <th>What It Knows</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Model</strong></td>
                            <td>Data & Business Logic</td>
                            <td>MongoDB structure, validation rules, CRUD operations</td>
                        </tr>
                        <tr>
                            <td><strong>View</strong></td>
                            <td>Browser-rendered Interface</td>
                            <td>HTML scaffolding (structure), JavaScript rendering logic, API integration, DOM updates</td>
                        </tr>
                        <tr>
                            <td><strong>Controller</strong></td>
                            <td>Coordination</td>
                            <td>HTTP requests, routing, which Model/View to use</td>
                        </tr>
                    </tbody>
                </table>

                <h3>‚úÖ Benefits of MVC</h3>
                <div class="jp-card" style="background: #f1f8e9; border-left: 4px solid #689f38;">
                    <ul>
                        <li><strong>Separation of Concerns</strong> - Each component has a single responsibility</li>
                        <li><strong>Reusability</strong> - Model can be used by multiple Controllers</li>
                        <li><strong>Testability</strong> - Components can be tested independently</li>
                        <li><strong>Maintainability</strong> - Easy to find and fix bugs</li>
                        <li><strong>Team Collaboration</strong> - Different developers can work on different layers</li>
                    </ul>
                </div>

                <h3>üîÄ Compare: MPA vs SPA</h3>
                <div class="jp-card" style="background: #fff3cd; border-left: 4px solid #ff6b6b;">
                    <h4 style="margin-top: 0;">This To-Do App (jPulse MPA Hybrid)</h4>
                    <ul>
                        <li>‚úÖ Server renders HTML scaffolding (structure, no data)</li>
                        <li>‚úÖ Browser JavaScript fetches data via REST API</li>
                        <li>‚úÖ Browser JavaScript updates DOM dynamically</li>
                        <li>‚úÖ Page reloads on navigation (MPA pattern)</li>
                        <li>‚ö†Ô∏è Requires JavaScript for functionality (API calls)</li>
                        <li>‚ùå Full page reload on each action</li>
                    </ul>
                    <p class="jp-help-text">üí° <strong>Architecture:</strong> Model + Controller on server, View logic in browser</p>
                </div>

                <div class="jp-card" style="background: #e8f5e9; border-left: 4px solid #4caf50; margin-top: 1rem;">
                    <h4 style="margin-top: 0;">Vue.js SPA (Single Page App)</h4>
                    <ul>
                        <li>‚úÖ Client renders UI dynamically</li>
                        <li>‚úÖ Instant UI updates, no page reloads</li>
                        <li>‚úÖ Smooth, app-like experience</li>
                        <li>‚úÖ Efficient data loading (only what changed)</li>
                        <li>‚ùå More complex setup and architecture</li>
                    </ul>
                    <p class="jp-help-text">üí° See the <a href="/hello-vue/">Vue.js SPA Demo</a> to compare!</p>
                </div>

                <h3>üìö Next: Explore More Examples</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <a href="/hello-vue/" class="jp-card" style="text-decoration: none; color: inherit; cursor: pointer;">
                        <h4 style="margin-top: 0;">üîÑ Vue.js SPA</h4>
                        <p>See how a Single Page Application differs from this MPA</p>
                    </a>
                    <a href="/hello-websocket/" class="jp-card" style="text-decoration: none; color: inherit; cursor: pointer;">
                        <h4 style="margin-top: 0;">üîå WebSocket Real-Time</h4>
                        <p>Learn real-time communication with WebSockets</p>
                    </a>
                    <a href="/hello/" class="jp-card" style="text-decoration: none; color: inherit; cursor: pointer;">
                        <h4 style="margin-top: 0;">üåê All Examples</h4>
                        <p>Back to the examples dashboard</p>
                    </a>
                </div>
            </div>

            <!-- Navigation -->
            <div class="jp-btn-nav-group">
                <a href="/" class="jp-btn jp-btn-outline">üè† Home</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello/" class="jp-btn jp-btn-outline">üåê Hello World Site Demos</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/" class="jp-btn jp-btn-active">üìã To-Do MVC Demo</a>
            </div>
        </div>
    </div>
    {{file.include "jpulse-footer.tmpl"}}
</body>
</html>
