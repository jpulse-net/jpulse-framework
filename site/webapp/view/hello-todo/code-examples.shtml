<!DOCTYPE html>
<!--
 * @name            jPulse Framework / Site / WebApp / View / Hello To-Do / Code Examples
 * @tagline         Code Examples for To-Do MVC Demo
 * @description     Model, View, and Controller code snippets
 * @file            site/webapp/view/hello-todo/code-examples.shtml
 * @version         1.6.18
 * @release         2026-02-18
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 2.4, Claude Sonnet 4.5
-->
<html {{appConfig.system.htmlAttrs}}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do MVC Demo - Code Examples - {{app.site.shortName}}</title>
    {{file.include "jpulse-header.tmpl"}}
</head>
<body>
    <div class="jp-main">
        <div class="jp-container-1000">
            <div class="jp-page-header">
                <h1>üìã To-Do MVC Demo</h1>
            </div>

            <!-- Sub-navigation -->
            <nav class="jp-btn-nav-group">
                <a href="/hello-todo/" class="jp-btn jp-btn-outline">üìñ Overview</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/todo-app.shtml" class="jp-btn jp-btn-outline">‚úÖ To-Do App</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/code-examples.shtml" class="jp-btn jp-btn-outline jp-btn-active">üíª Code Examples</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/architecture.shtml" class="jp-btn jp-btn-outline">üèóÔ∏è Architecture</a>
            </nav>

            <div class="jp-card">
                <h2>üíª MVC Code Examples</h2>

                <div class="jp-info-box">
                    <p>See the actual implementation of Model, View, and Controller components in the To-Do app.</p>
                </div>

                <!-- Model Code -->
                <h3 class="jp-text-primary">üìä Model: helloTodo.js (Model)</h3>
                <p>The Model handles all database operations with MongoDB:</p>

                <div class="jp-source-code" data-lang="javascript" data-show-lang="true">
                    <pre>// site/webapp/model/helloTodo.js

import { ObjectId } from 'mongodb';

const database = global.Database;

class HelloTodoModel {
    static getCollection() {
        return database.getDb().collection('helloTodos');
    }

    // Find all todos, sorted by creation date (newest first)
    static async findAll() {
        const collection = this.getCollection();
        return await collection.find({}).sort({ createdAt: -1 }).toArray();
    }

    // Create a new todo (validates and applies defaults in full implementation)
    static async create(todoData) {
        const collection = this.getCollection();
        const todo = {
            title: todoData.title.trim(),
            completed: false,
            username: todoData.username,
            userFirstName: todoData.userFirstName || '',
            userLastName: todoData.userLastName || '',
            createdAt: new Date(),
            updatedAt: new Date()
        };
        const result = await collection.insertOne(todo);
        return await collection.findOne({ _id: result.insertedId });
    }

    // Toggle todo completion
    static async toggleComplete(id) {
        const collection = this.getCollection();
        const todo = await collection.findOne({ _id: new ObjectId(id) });
        if (!todo) throw new Error('Todo not found');
        await collection.updateOne(
            { _id: new ObjectId(id) },
            { $set: { completed: !todo.completed, updatedAt: new Date() } }
        );
        return await collection.findOne({ _id: new ObjectId(id) });
    }

    // Delete a todo
    static async delete(id) {
        const collection = this.getCollection();
        const result = await collection.deleteOne({ _id: new ObjectId(id) });
        if (result.deletedCount === 0) throw new Error('Todo not found');
    }

    static async getStats() {
        const collection = this.getCollection();
        const [total, completed] = await Promise.all([
            collection.countDocuments({}),
            collection.countDocuments({ completed: true })
        ]);
        return { total, completed, pending: total - completed };
    }
}

export default HelloTodoModel;</pre>
            </div>

                <!-- Controller Code -->
                <h3 class="jp-text-success jp-mt-30">üéÆ Controller: helloTodo.js (Controller)</h3>
                <p>The Controller handles HTTP requests and coordinates Model & View:</p>

                <div class="jp-source-code" data-lang="javascript" data-show-lang="true">
                    <pre>// site/webapp/controller/helloTodo.js

import HelloTodoModel from '../model/helloTodo.js';

class HelloTodoController {
    // API: Get all todos and stats (REST endpoint)
    static async api(req, res) {
        const todos = await HelloTodoModel.findAll();
        const stats = await HelloTodoModel.getStats();
        res.json({ success: true, data: todos, stats });
    }

    // API: Create a new todo
    static async apiCreate(req, res) {
        const { title } = req.body;
        const user = req.session?.user || {};

        const todoData = {
            title: title.trim(),
            username: user.username || 'guest',
            userFirstName: user.firstName || '',
            userLastName: user.lastName || ''
        };

        const todo = await HelloTodoModel.create(todoData);
        res.json({ success: true, data: todo });
    }

    // API: Toggle todo completion
    static async apiToggle(req, res) {
        const { id } = req.params;
        const todo = await HelloTodoModel.toggleComplete(id);
        res.json({ success: true, data: todo });
    }

    // API: Delete a todo
    static async apiDelete(req, res) {
        const { id } = req.params;
        await HelloTodoModel.delete(id);
        res.json({ success: true });
    }
}

export default HelloTodoController;</pre>
            </div>

                <!-- View Code -->
                <h3 class="jp-text-warning jp-mt-30">üé® View: todo-app.shtml (Template + Client JS)</h3>
                <p>The View provides HTML scaffolding; the browser fetches data via API and updates the DOM with a <code>HelloTodoApp</code> class:</p>

                <div class="jp-source-code" data-lang="html" data-show-lang="true">
                    <pre>&lt;!-- site/webapp/view/hello-todo/todo-app.shtml: empty list, form, then script --&gt;

&lt;ul class="local-todo-list" id="todoList"&gt;&lt;/ul&gt;

&lt;script&gt;
class HelloTodoApp {
    constructor() { this.todos = []; this.init(); }

    async init() {
        this.bindEvents();
        await this.loadTodos();
    }

    async loadTodos() {
        const response = await jPulse.api.call('/api/1/helloTodo', { method: 'GET' });
        if (response.success) {
            this.todos = response.data || [];
            this.updateStats(response.stats || {});
            this.renderTodos();
        }
    }

    async handleAddTodo(e) {
        e.preventDefault();
        const title = document.getElementById('todoTitle').value.trim();
        if (!title) return;
        const response = await jPulse.api.call('/api/1/helloTodo', {
            method: 'POST',
            body: { title }
        });
        if (response.success) {
            this.todos.unshift(response.data);
            this.renderTodos();
        }
    }

    renderTodos() {
        // Update DOM from this.todos (no page reload)
    }
}
const todoApp = new HelloTodoApp();
&lt;/script&gt;</pre>
                </div>

                <h3>üîó Key Patterns</h3>
                <div class="jp-card">
                    <ul>
                        <li><strong>Separation of Concerns</strong> - Model, View, and Controller are separate files</li>
                        <li><strong>REST API</strong> - Clean endpoints: GET, POST, PUT, DELETE</li>
                        <li><strong>MongoDB ObjectId</strong> - Proper handling of MongoDB IDs</li>
                        <li><strong>Session Management</strong> - Track todos per user via session</li>
                        <li><strong>Client-Server Communication</strong> - API calls with jPulse.api helper</li>
                        <li><strong>Client-side rendering</strong> - API fetch then <code>renderTodos()</code> updates DOM (no full page reload)</li>
                    </ul>
                </div>

                <div class="jp-output jp-output-warning jp-mt-15">
                    <h4>üí° Hybrid MPA Pattern:</h4>
                    <p>Server renders the page structure; the browser fetches data via <code>jPulse.api.call('/api/1/helloTodo')</code> and updates the DOM with <code>renderTodos()</code>‚Äîno full page reload on add/toggle/delete.</p>
                    <p>Compare to the <a href="/hello-vue/">Vue.js SPA</a> for a full client-side framework with reactive components.</p>
                </div>
            </div>

            <!-- Navigation -->
            <div class="jp-btn-nav-group">
                <a href="/" class="jp-btn jp-btn-outline">üè† Home</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello/" class="jp-btn jp-btn-outline">üåê Hello World Site Demos</a>
                <span class="jp-btn-nav-arrow">‚Üí</span>
                <a href="/hello-todo/" class="jp-btn jp-btn-active">üìã To-Do MVC Demo</a>
            </div>
        </div>
    </div>
    {{file.include "jpulse-footer.tmpl"}}
</body>
</html>
