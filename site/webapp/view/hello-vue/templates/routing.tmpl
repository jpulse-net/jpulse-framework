<!-- SPA routing configuration, site/webapp/view/hello-vue/templates/routing.tmpl -->
<!-- This file defines the routing structure for the Vue.js SPA -->

<script type="text/javascript">

// Navigation configuration
const helloVueNavigation = {
    showOnOverview: true,  // Show navigation on overview page
    showOnOtherPages: true, // Show navigation on other pages
    style: 'buttons',      // 'buttons' or 'tabs'
    layout: 'horizontal'   // 'horizontal' or 'vertical'
};

// Initialize SPA routes on window object
window.jpSpaRoutes = window.jpSpaRoutes || {};

// Define routes FIRST before any components
window.helloVueRoutes = [
    {
        path: '/overview',
        component: 'Overview',
        title: 'Overview',
        icon: 'ðŸš€',
        description: 'Welcome to the Vue.js SPA Demo'
    },
    {
        path: '/todo-demo',
        component: 'TodoDemo',
        title: 'Interactive Demo',
        icon: 'ðŸŽ¯',
        description: 'Experience real to-do management with Vue.js reactivity and API integration'
    },
    {
        path: '/features',
        component: 'Features',
        title: 'SPA Features',
        icon: 'âš¡',
        description: 'Learn about the technical benefits and implementation details'
    },
    {
        path: '/code',
        component: 'Code',
        title: 'Code Examples',
        icon: 'âš™ï¸',
        description: 'See the actual implementation patterns and code snippets'
    },
    {
        path: '/about',
        component: 'About',
        title: 'About',
        icon: 'â„¹ï¸',
        description: 'Learn about the benefits of a Vue.js based SPA (single page application)'
    }
];

// Include all page components as JavaScript
{{file.include "hello-vue/templates/overview.tmpl"}}
{{file.include "hello-vue/templates/todo-demo.tmpl"}}
{{file.include "hello-vue/templates/features.tmpl"}}
{{file.include "hello-vue/templates/code.tmpl"}}
{{file.include "hello-vue/templates/about.tmpl"}}

// Wait for DOM to be ready and Vue/VueRouter to be available using jPulse
jPulse.dom.ready(() => {
    if (typeof Vue === 'undefined') {
        const msg = 'Error: Vue is not loaded. Please check the script tag.';
        console.error('- ' + msg);
        jPulse.showSlideDownMessage(msg, 'error');
        return;
    } else if (typeof VueRouter === 'undefined') {
        const msg = 'Error: Vue Router is not loaded. Please check the script tag.';
        console.error('- ' + msg);
        jPulse.showSlideDownMessage(msg, 'error');
        return;
    }
    // Extract Vue and Vue Router functions
    const { createApp } = Vue;
    const { createRouter, createWebHistory } = VueRouter;

    // Create router
    const router = createRouter({
        history: createWebHistory('/hello-vue/'),
        routes: [
            ...window.helloVueRoutes.map(route => ({
                path: route.path,
                component: window.jpSpaRoutes[route.component] || window.jpSpaRoutes.Overview
            })),
            // Add redirect for / to /overview
            {
                path: '/',
                redirect: '/overview'
            }
        ]
    });

    // Main Vue app
    const app = createApp({
        template: `
            <div>
                <nav class="hello-vue-nav">
                    <button
                        v-for="nav in navigation"
                        :key="nav.path"
                        @click="navigateTo(nav.path)"
                        :class="['jp-btn', 'jp-btn-outline', { 'jp-btn-active': currentPath === nav.path }]"
                    >
                        {{ nav.label }}
                    </button>
                </nav>
                <div class="hello-vue-content">
                    <router-view></router-view>
                </div>
            </div>
        `,
        data() {
            const navigation = window.helloVueRoutes.map(route => ({
                path: route.path,
                label: route.title
            }));
            return {
                navigation: navigation,
                currentPath: '/'
            };
        },
        methods: {
            navigateTo(path) {
                this.currentPath = path;
                this.$router.push(path);
            }
        },
        mounted() {
            // Wait for router to be ready
            this.$nextTick(() => {
                this.currentPath = this.$route ? this.$route.path : '/';
                console.log('- Vue app mounted, current route:', this.$route);
            });
        },
        watch: {
            '$route'(to, from) {
                this.currentPath = to.path;
                console.log('- Route changed to:', to.path);
            }
        }
    });

    // Use router
    app.use(router);

    // Hide loading overlay
    const loadingOverlay = document.getElementById('spaLoadingOverlay');
    if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
    }

    // Check if target element exists
    const targetElement = document.getElementById('helloVueApp');

    if (targetElement) {
        try {
            app.mount('#helloVueApp');
        } catch (error) {
            const msg = 'Error: Failed to mount Vue app: ' + error;
            console.error('- ' + msg);
            jPulse.showSlideDownMessage(msg, 'error');
        }
    } else {
        const msg = 'Error: Target element #helloVueApp not found';
        console.error('- ' + msg);
        jPulse.showSlideDownMessage(msg, 'error');
    }
});

// Fallback: Hide loading overlay after 2 seconds regardless
setTimeout(() => {
    const loadingOverlay = document.getElementById('spaLoadingOverlay');
    if (loadingOverlay && loadingOverlay.style.display !== 'none') {
        console.log('- Fallback: Hiding loading overlay after timeout');
        loadingOverlay.style.display = 'none';
    }
}, 2000);
</script>

<!-- EOF SPA routing configuration, site/webapp/view/hello-vue/templates/routing.tmpl -->
