// To-do page component, site/webapp/view/hello-vue/templates/todo-demo.tmpl
/**
 * @name            jPulse Framework / Site / WebApp / View / Hello Vue / Templates / To-Do Demo Page
 * @tagline         Do-do Demo of Hello Vue Single Page Application
 * @description     This page demonstrates the reactive behavior of the Vue.js SPA
 * @file            site/webapp/view/hello-vue/templates/todo-demo.tmpl
 * @version         1.1.6
 * @release         2025-11-14
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 1.7, Claude Sonnet 4
 */

window.jpSpaRoutes.TodoDemo = {
    template: `
        <div class="jp-card">
            <h2>Interactive To-Do Demo</h2>
            <p class="jp-text">Experience Vue.js reactivity and API integration with real to-do management.</p>

            <!-- Statistics Dashboard -->
            <div class="jp-dashboard-grid local-stats-grid">
                <div class="jp-card-dashboard local-stats-card local-non-clickable-card">
                    <div class="jp-icon-container local-icon-container">üìä</div>
                    <h3 class="jp-card-title">{{ stats.totalTodos || 0 }}</h3>
                    <p class="jp-card-description">Total To-dos</p>
                </div>
                <div class="jp-card-dashboard local-stats-card local-non-clickable-card">
                    <div class="jp-icon-container local-icon-container">‚úÖ</div>
                    <h3 class="jp-card-title">{{ stats.completedTodos || 0 }}</h3>
                    <p class="jp-card-description">Completed</p>
                </div>
                <div class="jp-card-dashboard local-stats-card local-non-clickable-card">
                    <div class="jp-icon-container local-icon-container">‚è≥</div>
                    <h3 class="jp-card-title">{{ stats.pendingTodos || 0 }}</h3>
                    <p class="jp-card-description">Pending</p>
                </div>
            </div>

            <!-- Add To-do Form -->
            <div class="local-todo-form">
                <div class="jp-form-group">
                    <input
                        v-model="newTodoTitle"
                        @keyup.enter="createTodo"
                        type="text"
                        placeholder="Add a new to-do to test Vue.js reactivity..."
                        class="jp-form-input"
                    >
                    <button @click="createTodo" class="jp-btn jp-btn-primary">
                        Add To-do
                    </button>
                </div>
            </div>

            <!-- To-do List -->
            <div class="local-todo-list">
                <h3>To-do List</h3>
                <div v-if="todos.length === 0" class="jp-text">
                    <p>No to-dos yet. Add one above to see Vue.js reactivity in action!</p>
                </div>
                <div v-else>
                    <div v-for="todo in todos" :key="todo._id" class="local-todo-item">
                        <label class="local-todo-checkbox">
                            <input
                                type="checkbox"
                                :checked="todo.completed"
                                @change="toggleTodo(todo)"
                            >
                            <span class="local-todo-text" :class="{ completed: todo.completed }">
                                {{ todo.title }}
                            </span>
                        </label>
                        <span class="local-todo-date">{{ formatDate(todo.createdAt) }} by {{ todo.username || 'guest' }}</span>
                    </div>
                </div>
            </div>
        </div>
    `,
    data() {
        return {
            newTodoTitle: '',
            todos: [],
            stats: {
                totalTodos: 0,
                completedTodos: 0,
                pendingTodos: 0
            }
        };
    },
    methods: {
        async createTodo() {
            if (!this.newTodoTitle.trim()) return;
            try {
                const response = await jPulse.api.call('/api/1/helloTodo', {
                    method: 'POST',
                    body: {
                        title: this.newTodoTitle.trim()
                    }
                });

                if (response.success && response.data) {
                    this.todos.unshift(response.data);
                    this.newTodoTitle = '';
                    jPulse.UI.toast.show('To-do created!', 'success');
                    this.updateStats();
                } else {
                    throw new Error(response.message || 'Failed to add to-do');
                }
            } catch (error) {
                jPulse.api.handleError(error, 'create to-do');
            }
        },

        async toggleTodo(todo) {
            try {
                const response = await jPulse.api.call('/api/1/helloTodo/' + todo._id + '/toggle', {
                    method: 'PUT'
                });
                if (response.success && response.data) {
                    const index = this.todos.findIndex(t => t._id === todo._id);
                    if (index !== -1) {
                        this.todos[index] = response.data;
                    }
                    this.updateStats();
                } else {
                    throw new Error(response.message || 'Failed to update to-do');
                }
            } catch (error) {
                console.error('Error toggling to-do:', error);
                jPulse.UI.toast.show(error.message || 'Failed to update to-do', 'error');
            }
        },

        async fetchTodos() {
            try {
                const response = await jPulse.api.call('/api/1/helloTodo', {
                    method: 'GET'
                });

                if (response.success && response.data) {
                    this.todos = response.data || [];
                    this.updateStats();
                } else {
                    throw new Error(response.message || 'Failed to load to-dos');
                }
            } catch (error) {
                console.warn('- To-do data not available - this is normal if hello-todo is not set up');
                // Don't show toast for fetch errors as this is often expected during development
            }
        },

        updateStats() {
            this.stats.totalTodos = this.todos.length;
            this.stats.completedTodos = this.todos.filter(t => t.completed).length;
            this.stats.pendingTodos = this.todos.filter(t => !t.completed).length;
        },

        formatDate(date) {
            return jPulse.date.formatLocalDate(date);
        }
    },

    mounted() {
        this.fetchTodos();
    }
};

// EOF To-do page component, site/webapp/view/hello-vue/templates/todo-demo.tmpl
