<!DOCTYPE html>
<!--
 * @name            jPulse Framework / WebApp / View / Home
 * @tagline         Home page of jPulse Framework
 * @description     This is the home page of jPulse Framework
 * @file            webapp/view/home/index.shtml
 * @version         0.5.5
 * @release         2025-09-12
 * @repository      https://github.com/peterthoeny/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         AGPL v3, see LICENSE file
 * @genai           99%, Cursor 1.2, Claude Sonnet 4
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{app.version}} - {{i18n.view.home.title}}</title>

    {{file.include "jpulse-header.tmpl"}}
    <style>
        /* Page-specific demo content styles only */
        .local-demo-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #dee2e6;
        }

        .demo-spacer {
            height: 200px;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .demo-spacer-1 { background: linear-gradient(45deg, #e3f2fd, #bbdefb); }
        .demo-spacer-2 { background: linear-gradient(45deg, #f3e5f5, #e1bee7); }
        .demo-spacer-3 { background: linear-gradient(45deg, #e8f5e8, #c8e6c9); }
        .demo-spacer-4 { background: linear-gradient(45deg, #fff3e0, #ffcc02); }
        .demo-spacer-5 { background: linear-gradient(45deg, #ffebee, #ffcdd2); }
    </style>
</head>
<body>
    <div class="jp-main">
        <h1 class="jp-title">ü´ß {{app.name}} - Home Page</h1>

        <!-- Introduction Box (i18n messages) - at the top -->
        <div class="jp-info-box">
            <p>{{i18n.view.home.introduction}}</p>
            <p>{{#if user.authenticated}}{{i18n.view.home.welcomeBack}}{{else}}{{i18n.view.home.notLoggedIn}}{{/if}}</p>
        </div>

        <!-- User Information Box (testing content) -->
        <div class="jp-warning-box">
            <h3>User Information</h3>
            <p>{{#if user.authenticated}}{{i18n.view.home.welcomeBack}}{{else}}{{i18n.view.home.notLoggedIn}}{{/if}}</p>
            {{#if user.authenticated}}<p><strong>User ID:</strong> {{user.id}}</p>{{else}}<p>{{i18n.view.home.pleaseLogin}}</p>{{/if}}
            {{#if user.authenticated}}<p><strong>Name:</strong> {{user.firstName}} {{user.lastName}}</p>{{else}}{{/if}}
            {{#if user.authenticated}}<p><strong>Email:</strong> {{user.email}}</p>{{else}}{{/if}}
        </div>

        <!-- Framework Information Box -->
        <div class="jp-info-box">
            <p><strong>Framework:</strong> {{app.name}}</p>
            <p><strong>Version:</strong> <span class="jp-text-muted jp-text-small">{{app.version}} ({{app.release}})</span></p>
            <p><strong>Current URL:</strong> {{url.domain}}{{url.pathname}}{{url.search}}</p>
            <p><strong>Protocol:</strong> {{url.protocol}}</p>
            <p><strong>Hostname:</strong> {{url.hostname}}</p>
            <p>{{#if url.port}}<strong>Port:</strong> {{else}}{{/if}}{{url.port}}</p>
            <p><strong>Test 404 link:</strong> <a href="/home/x.shtml">/home/x.shtml</a></p>
        </div>

        <!-- Handlebars Demo Box -->
        <div class="jp-card">
            <div class="jp-card-header">
                <h3>Handlebars Demo</h3>
            </div>
            <div class="jp-card-body">
                <p>This page demonstrates various handlebars features:</p>
                <ul>
                    <li><strong>App info:</strong> {{app.version}} / {{app.release}}</li>
                    <li><strong>URL parsing:</strong> {{url.domain}} + {{url.pathname}}</li>
                    <li><strong>URL params:</strong> Try ?name=test ‚Üí {{url.param.name}}</li>
                    <li><strong>User roles:</strong> {{user.roles}}</li>
                    <li><strong>Conditionals:</strong> {{#if user.authenticated}}User {{user.username}} is logged in{{else}}User is guest{{/if}}</li>
                    <li><strong>i18n:</strong>
                        {{#if user.authenticated}}
                          {{i18n.view.auth.login.welcomeBack}}
                        {{else}}
                          {{i18n.view.auth.common.notAuthenticated}}
                        {{/if}}
                    </li>
                    <li><strong>Config:</strong> Admin email: {{config.email.adminEmail}}</li>
                    <li><strong>User object debug:</strong></li>
                    <li><strong>user.authenticated:</strong> {{user.authenticated}}</li>
                    <li><strong>user.id:</strong> {{user.id}}</li>
                    <li><strong>user.username:</strong> {{user.username}}</li>
                    <li><strong>user.firstName:</strong> {{user.firstName}}</li>
                    <li><strong>user.nickName:</strong> {{user.nickName}}</li>
                    <li><strong>user.lastName:</strong> {{user.lastName}}</li>
                    <li><strong>user.email:</strong> {{user.email}}</li>
                    <li><strong>user.roles:</strong> {{user.roles}}</li>
                    <li><strong>user.isAdmin:</strong> {{user.isAdmin}}</li>
                </ul>
            </div>
        </div>

        <!-- Site Override API Demo -->
        <div class="jp-card">
            <div class="jp-card-header">
                <h3>üéØ Site Override API Demo</h3>
            </div>
            <div class="jp-card-body">
                <p>Test the W-014 site override system with a live API call:</p>
                <button id="testSiteApiBtn" class="jp-btn jp-btn-secondary">Test Site Override API</button>
                <div id="siteApiResponse" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px; display: none;">
                    <strong>API Response:</strong>
                    <pre id="siteApiResponseContent" style="margin: 10px 0; white-space: pre-wrap; font-size: 12px;"></pre>
                </div>
                <p style="margin-top: 10px;">
                    <small>
                        This calls <code>/api/1/hello</code> which is auto-discovered from <code>site/webapp/controller/hello.js</code>
                        <br>
                        <a href="/hello/">Visit the full demo page</a> | <a href="/api/1/hello" target="_blank">View raw API response</a>
                    </small>
                </p>
            </div>
        </div>

        <!-- Status Information -->
        <p>This is a server-side rendered template using the viewController with handlebars processing.</p>
        <p><strong>Status:</strong> <span class="jp-theme-text-primary" style="color: #007acc; font-weight: bold;">‚úÖ W-006 viewController - IMPLEMENTED</span></p>

        <!-- Sticky Header Test Box -->
        <div class="jp-info-box">
            <h3>üîç Sticky Header Test</h3>
            <p><strong>Instructions:</strong> Scroll down this page to see the sticky header in action!</p>
            <p>The blue header with the jPulse logo should remain fixed at the top of the browser window as you scroll.</p>
        </div>

        <div class="demo-spacer demo-spacer-1">
            <h4>üìè Spacer Content Block 1</h4>
        </div>

        <div class="demo-spacer demo-spacer-2">
            <h4>üìè Spacer Content Block 2</h4>
        </div>

        <div class="demo-spacer demo-spacer-3">
            <h4>üìè Spacer Content Block 3</h4>
        </div>

        <div class="demo-spacer demo-spacer-4">
            <h4>üìè Spacer Content Block 4 - Keep Scrolling!</h4>
        </div>

        <div class="demo-spacer demo-spacer-5">
            <h4>üéØ Bottom Content - Header should still be visible!</h4>
        </div>

        <p><em>File timestamp: {{file.timestamp "jpulse-footer.tmpl"}}</em></p>

        <!-- W-048 Dialog Demo -->
        <div class="jp-card">
            <div class="jp-card-header">
                <h3>jPulse.UI Dialog Demo (W-048)</h3>
            </div>
            <div class="jp-card-body">
                <p>Test the new jPulse.UI dialog widgets:</p>
                <div class="jp-btn-group">
                    <button id="testAlertBtn" class="jp-btn jp-btn-danger">Test Alert Dialog</button>
                    <button id="testInfoBtn" class="jp-btn jp-btn-primary">Test Info Dialog</button>
                    <button id="testHtmlBtn" class="jp-btn jp-btn-secondary">Test HTML Content</button>
                    <button id="testCustomBtn" class="jp-btn jp-btn-success">Test Custom Options</button>
                    <button id="testConfirmBtn" class="jp-btn jp-btn-warning">Test Complex Confirm Dialog</button>
                </div>
            </div>
        </div>

        <!-- W-048 Accordion Demo -->
        <div class="jp-card">
            <div class="jp-card-header">
                <h3>jPulse.UI Accordion Demo (W-048)</h3>
            </div>
            <div class="jp-card-body">
                <p>Test accordion with flexible decoration detection:</p>

                <h4>Standalone Accordion (Full Decoration)</h4>
                <div id="standaloneAccordion" class="jp-accordion">
                    <div class="jp-accordion-section">
                        <h3>Getting Started</h3>
                        <div class="jp-accordion-content">
                            <p>This is a standalone accordion with full section-like decoration. It has its own background, border, and padding.</p>
                            <ul>
                                <li>Automatic decoration detection</li>
                                <li>Mutual exclusion (only one open at a time)</li>
                                <li>Smooth animations</li>
                            </ul>
                        </div>
                    </div>
                    <div class="jp-accordion-section">
                        <h3>Advanced Features</h3>
                        <div class="jp-accordion-content">
                            <p>Advanced accordion features include:</p>
                            <ul>
                                <li>Programmatic control via handle object</li>
                                <li>Custom event dispatching</li>
                                <li>Flexible configuration options</li>
                            </ul>
                        </div>
                    </div>
                    <div class="jp-accordion-section">
                        <h3>API Reference</h3>
                        <div class="jp-accordion-content">
                            <p>Use the accordion API:</p>
                            <pre><code>const accordion = jPulse.UI.accordion.register('myAccordion', {
    exclusive: true,
    initOpen: 0
});

accordion.openSection(1);
accordion.closeAll();</code></pre>
                        </div>
                    </div>
                </div>

                <h4>Nested Accordion (Inside Section)</h4>
                <div class="local-demo-section">
                    <p>This accordion is nested inside a section container, so it gets minimal internal styling:</p>

                    <div id="nestedAccordion" class="jp-accordion">
                        <div class="jp-accordion-section">
                            <h3>FAQ: How does it work?</h3>
                            <div class="jp-accordion-content">
                                <p>The accordion automatically detects if it's inside a section container and applies appropriate styling.</p>
                            </div>
                        </div>
                        <div class="jp-accordion-section">
                            <h3>FAQ: Can I customize it?</h3>
                            <div class="jp-accordion-content">
                                <p>Yes! You can configure exclusive behavior, initial open section, and event callbacks.</p>
                            </div>
                        </div>
                        <div class="jp-accordion-section">
                            <h3>FAQ: Is it accessible?</h3>
                            <div class="jp-accordion-content">
                                <p>The accordion includes keyboard navigation support and custom events for screen readers.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="jp-btn-group">
                    <button id="testAccordionBtn" class="jp-btn jp-btn-primary">Test Programmatic Control</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const testBtn = document.getElementById('testSiteApiBtn');
            const responseDiv = document.getElementById('siteApiResponse');
            const responseContent = document.getElementById('siteApiResponseContent');

            if (testBtn) {
                testBtn.addEventListener('click', async function() {
                    testBtn.disabled = true;
                    testBtn.textContent = 'Testing...';
                    responseDiv.style.display = 'none';

                    try {
                        // Use jPulse.apiCall to test the site override API
                        const response = await jPulse.apiCall('/api/1/hello', 'GET');

                        responseDiv.style.display = 'block';
                        responseContent.textContent = JSON.stringify(response, null, 2);
                        responseDiv.style.background = '#e8f5e8'; // Success green

                    } catch (error) {
                        responseDiv.style.display = 'block';
                        responseContent.textContent = `Error: ${error.message}`;
                        responseDiv.style.background = '#ffebee'; // Error red
                    }

                    testBtn.disabled = false;
                    testBtn.textContent = 'Test Site Override API';
                });
            }

            // W-048 Dialog Demo Event Handlers
            const testAlertBtn = document.getElementById('testAlertBtn');
            const testInfoBtn = document.getElementById('testInfoBtn');
            const testHtmlBtn = document.getElementById('testHtmlBtn');
            const testCustomBtn = document.getElementById('testCustomBtn');

            if (testAlertBtn) {
                testAlertBtn.addEventListener('click', async function() {
                    await jPulse.UI.alertDialog('This is a test alert dialog with red header styling!');
                });
            }

            if (testInfoBtn) {
                testInfoBtn.addEventListener('click', async function() {
                    await jPulse.UI.infoDialog('This is a test info dialog with blue header styling.');
                });
            }

            if (testHtmlBtn) {
                testHtmlBtn.addEventListener('click', async function() {
                    await jPulse.UI.infoDialog('<p>This dialog supports <b>basic HTML</b> formatting:</p><p>‚Ä¢ <i>Italic text</i><br>‚Ä¢ <b>Bold text</b><br>‚Ä¢ Line breaks and paragraphs</p>');
                });
            }

            if (testCustomBtn) {
                testCustomBtn.addEventListener('click', async function() {
                    await jPulse.UI.alertDialog('Custom sized dialog with minimum dimensions.', {
                        title: 'Custom Alert',
                        minWidth: 500,
                        minHeight: 200
                    });
                });
            }

            // Complex confirm dialog test
            const testConfirmBtn = document.getElementById('testConfirmBtn');
            if (testConfirmBtn) {
                testConfirmBtn.addEventListener('click', async function() {
                    // Create file list with checkboxes
                    const fileListHtml = `
                        <p>Select files to delete:</p>
                        <div style="text-align: left; margin: 15px 0; line-height: 1.8;">
                            <div style="margin: 8px 0;">
                                <input type="checkbox" id="file1" checked style="margin-right: 8px;">
                                <label for="file1">document1.pdf</label>
                            </div>
                            <div style="margin: 8px 0;">
                                <input type="checkbox" id="file2" checked style="margin-right: 8px;">
                                <label for="file2">image.jpg</label>
                            </div>
                            <div style="margin: 8px 0;">
                                <input type="checkbox" id="file3" style="margin-right: 8px;">
                                <label for="file3">backup.zip</label>
                            </div>
                            <div style="margin: 8px 0;">
                                <input type="checkbox" id="file4" checked style="margin-right: 8px;">
                                <label for="file4">notes.txt</label>
                            </div>
                        </div>
                    `;

                    const result = await jPulse.UI.confirmDialog({
                        title: 'Delete Files',
                        message: fileListHtml,
                        buttons: {
                            'Cancel': (dialog) => {
                                // Close dialog (default behavior)
                                return false;
                            },
                            'Delete Selected Files': async (dialog) => {
                                // Get selected files
                                const checkboxes = dialog.querySelectorAll('input[type="checkbox"]:checked');
                                const selectedFiles = Array.from(checkboxes).map(cb => {
                                    const label = dialog.querySelector(`label[for="${cb.id}"]`);
                                    return label ? label.textContent.trim() : cb.id;
                                });

                                if (selectedFiles.length === 0) {
                                    await jPulse.UI.alertDialog('Please select at least one file to delete.');
                                    return true; // dontClose - keep first dialog open
                                }

                                // Show second confirmation dialog
                                const confirmResult = await jPulse.UI.confirmDialog({
                                    title: 'Confirm Deletion',
                                    message: `<p>Do you want to delete the selected files?</p><ul>${selectedFiles.map(file => `<li>${file}</li>`).join('')}</ul>`,
                                    buttons: {
                                        'Cancel': () => {
                                            // Close second dialog, keep first open
                                            return false;
                                        },
                                        'Yes, Delete': () => {
                                            // Simulate file deletion
                                            console.log('Deleting files:', selectedFiles);
                                            jPulse.showSlideDownSuccess(`Deleted ${selectedFiles.length} file(s) successfully!`);
                                            return false; // Close second dialog
                                        }
                                    }
                                });

                                // If user confirmed deletion, close first dialog too
                                if (confirmResult.button === 'Yes, Delete') {
                                    return false; // Close first dialog
                                } else {
                                    return true; // Keep first dialog open
                                }
                            }
                        }
                    });

                    console.log('First dialog result:', result);
                });
            }

            // W-048 Accordion Demo Initialization
            let standaloneAccordion = null;
            let nestedAccordion = null;

            // Initialize accordions
            standaloneAccordion = jPulse.UI.accordion.register('standaloneAccordion', {
                exclusive: true,
                initOpen: 0, // First section open initially
                onSectionChange: (openIndex, clickedIndex) => {
                    console.log(`Standalone accordion: section ${clickedIndex} clicked, now open: ${openIndex}`);
                }
            });

            nestedAccordion = jPulse.UI.accordion.register('nestedAccordion', {
                exclusive: true,
                initOpen: null, // All closed initially
                onSectionChange: (openIndex, clickedIndex) => {
                    console.log(`Nested accordion: section ${clickedIndex} clicked, now open: ${openIndex}`);
                }
            });

            // Test programmatic control
            const testAccordionBtn = document.getElementById('testAccordionBtn');
            if (testAccordionBtn) {
                let testStep = 0;
                testAccordionBtn.addEventListener('click', function() {
                    switch (testStep) {
                        case 0:
                            // Open second section of standalone accordion
                            standaloneAccordion.openSection(1);
                            testAccordionBtn.textContent = 'Step 2: Open Nested FAQ';
                            break;
                        case 1:
                            // Open first section of nested accordion
                            nestedAccordion.openSection(0);
                            testAccordionBtn.textContent = 'Step 3: Close All';
                            break;
                        case 2:
                            // Close all sections
                            standaloneAccordion.closeAll();
                            nestedAccordion.closeAll();
                            testAccordionBtn.textContent = 'Step 4: Reset Demo';
                            break;
                        case 3:
                            // Reset to initial state
                            standaloneAccordion.openSection(0);
                            testStep = -1; // Will be incremented to 0
                            testAccordionBtn.textContent = 'Test Programmatic Control';
                            break;
                    }
                    testStep++;
                });
            }
        });
    </script>

    {{file.include "jpulse-footer.tmpl"}}
</body>
</html>
