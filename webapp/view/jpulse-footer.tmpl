<!-- Start webapp/view/jpulse-footer.tmpl -->
<!--
 * @name            jPulse Framework / WebApp / View / Footer Template
 * @tagline         Footer template for jPulse pages
 * @description     Footer included in all jPulse pages to provide a consistent page layout
 * @file            webapp/view/jpulse-footer.tmpl
 * @version         1.3.16
 * @release         2025-12-16
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 1.7, Claude Sonnet 4
-->
<!-- Visual Header Banner (positioned at top via CSS) -->
<header class="jp-header">
    <div class="jp-header-content">
        <!-- Mobile Hamburger Menu Icon (W-069) -->
        {{#if appConfig.view.pageDecoration.siteNavigation.enabled}}
        <button class="jp-hamburger" id="jp-hamburger" aria-label="Menu" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </button>
        {{/if}}
        <a href="/" class="jp-logo">
            <img src="/images/jpulse-logo/jpulse-logo-reverse.svg" alt="jPulse" height="22" width="22">
            <span class="jp-logo-name">{{app.site.name}}</span>
            <span class="jp-logo-shortname">{{app.site.shortName}}</span>
        </a>
        <div class="jp-user-menu">
            <div class="jp-user-icon" id="jp-user-icon">
              {{#if user.isAuthenticated}}
                <span>{{user.initials}}</span>
              {{else}}
                <span>ðŸ‘¤</span>
              {{/if}}
            </div>
            <div class="jp-dropdown" id="userDropdown">
              {{#if user.isAuthenticated}}
                <a href="/user/">{{i18n.view.user.index.dashboard}}</a>
                <a href="/user/profile.shtml">{{i18n.view.auth.common.profile}}</a>
                <a href="/auth/logout.shtml">{{i18n.view.auth.common.signout}}</a>
              {{else}}
                {{#unless appConfig.view.auth.hideLogin}}
                <a href="/auth/login.shtml">{{i18n.view.auth.common.signin}}</a>
                {{/unless}}
                {{#unless appConfig.view.auth.hideSignup}}
                <a href="/auth/signup.shtml">{{i18n.view.auth.common.signup}}</a>
                {{/unless}}
              {{/if}}
              {{#if user.isAdmin}}
                <a href="/admin/">{{i18n.view.user.index.adminDashboard}}</a>
              {{/if}}
            </div>
        </div>
    </div>
</header>

<!-- Mobile Menu Overlay (W-069) -->
{{#if appConfig.view.pageDecoration.siteNavigation.enabled}}
<div class="jp-mobile-menu-overlay" id="jp-mobile-menu-overlay"></div>
<nav class="jp-mobile-menu" id="jp-mobile-menu" aria-label="Mobile Navigation"></nav>
{{/if}}

<!-- Footer -->
<footer class="jp-footer">
    <div class="jp-footer-content">
        <div class="jp-footer-left">
            <span>{{app.site.copyright}}</span>
        </div>
        <div class="jp-footer-right">
            <span class="jp-version"><a href="https://jpulse.net/" target="_blank">Powered by jPulse Framework {{app.jPulse.version}}</a></span>
        </div>
    </div>
</footer>

<!-- Site Navigation Initialization (W-069, W-098) -->
<style>
{{#if appConfig.view.pageDecoration.siteNavigation.enabled}}
:root {
    --jp-header-height: {{appConfig.view.pageDecoration.headerHeight}}px;
}
{{/if}}
</style>
<script>
jPulse.dom.ready(() => {
    {{#if appConfig.view.pageDecoration.siteNavigation.enabled}}
    // Initialize site navigation when DOM is ready
    // Note: Handlebars values are strings, so convert to numbers
    jPulse.UI.navigation.init({
        currentUrl: `{{url.pathname}}`,
        userRoles: {{user.roles}},
        navigation: window.jPulseNavigation.site,
        openDelay: parseInt(`{{appConfig.view.pageDecoration.siteNavigation.openDelay}}`, 10),
        closeDelay: parseInt(`{{appConfig.view.pageDecoration.siteNavigation.closeDelay}}`, 10),
        submenuCloseDelay: parseInt(`{{appConfig.view.pageDecoration.siteNavigation.submenuCloseDelay}}`, 10)
    });
    {{/if}}
    {{#if appConfig.view.pageDecoration.breadcrumbs.enabled}}
    // Initialize breadcrumbs when DOM is ready
    jPulse.UI.breadcrumbs.init({
        currentUrl: `{{url.pathname}}`,
        navigation: window.jPulseNavigation.site,
        homeLabel: `{{i18n.view.home.title}}`
    });
    {{/if}}

    // Enhanced user menu - hover behavior like site navigation with mobile fallback
    const userIcon = document.getElementById('jp-user-icon');
    const dropdown = document.getElementById('userDropdown');
    const userMenu = document.querySelector('.jp-user-menu');

    if (userIcon && dropdown && userMenu) {
        let hideTimeout = null;
        const isMobileDevice = jPulse.device.isMobile() || jPulse.device.isTouchDevice();

        if (isMobileDevice) {
            // Mobile: tap to toggle behavior ONLY
            userIcon.addEventListener('click', (event) => {
                event.preventDefault();
                event.stopPropagation();
                dropdown.classList.toggle('show');
            });

            // Close on outside tap
            document.addEventListener('click', (event) => {
                if (!userMenu.contains(event.target)) {
                    dropdown.classList.remove('show');
                }
            });

            // Close on menu item selection
            dropdown.addEventListener('click', (event) => {
                if (event.target.tagName === 'A') {
                    dropdown.classList.remove('show');
                }
            });

            // Prevent mouse events from interfering on mobile
            userIcon.addEventListener('mouseenter', (e) => e.preventDefault());
            userIcon.addEventListener('mouseleave', (e) => e.preventDefault());
            dropdown.addEventListener('mouseenter', (e) => e.preventDefault());
            dropdown.addEventListener('mouseleave', (e) => e.preventDefault());

        } else {
            // Desktop: hover behavior like site navigation ONLY
            userIcon.addEventListener('mouseenter', () => {
                if (hideTimeout) {
                    clearTimeout(hideTimeout);
                    hideTimeout = null;
                }
                dropdown.classList.add('show');
            });

            userIcon.addEventListener('mouseleave', (e) => {
                if (!dropdown.contains(e.relatedTarget)) {
                    hideTimeout = setTimeout(() => {
                        dropdown.classList.remove('show');
                        hideTimeout = null;
                    }, 600); // Match site menu delay
                }
            });

            dropdown.addEventListener('mouseenter', () => {
                if (hideTimeout) {
                    clearTimeout(hideTimeout);
                    hideTimeout = null;
                }
                dropdown.classList.add('show');
            });

            dropdown.addEventListener('mouseleave', () => {
                hideTimeout = setTimeout(() => {
                    dropdown.classList.remove('show');
                    hideTimeout = null;
                }, 500); // Slightly shorter delay for dropdown
            });

            // Prevent click events from interfering on desktop hover
            userIcon.addEventListener('click', (e) => e.preventDefault());
        }
    }
});
</script>

<!-- EOF webapp/view/jpulse-footer.tmpl -->
