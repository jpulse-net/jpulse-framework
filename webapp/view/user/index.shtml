<!DOCTYPE html>
<!--
 * @name            jPulse Framework / WebApp / View / User / Dashboard
 * @tagline         Personal user dashboard
 * @description     User dashboard with profile access and activity summary
 * @file            webapp/view/user/index.shtml
 * @version         1.3.12
 * @release         2025-12-08
 * @repository      https://github.com/jpulse-net/jpulse-framework
 * @author          Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @copyright       2025 Peter Thoeny, https://twiki.org & https://github.com/peterthoeny/
 * @license         BSL 1.1 -- see LICENSE file; for commercial use: team@jpulse.net
 * @genai           60%, Cursor 2.0, Claude Sonnet 4.5
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{i18n.view.user.index.title}} - {{app.site.shortName}}</title>

    {{file.include "jpulse-header.tmpl"}}
</head>
<body>
    <div class="jp-main">
        <div class="jp-page-header">
            <h1>{{i18n.view.user.index.title}}</h1>
            <span class="jp-subtitle">{{i18n.view.user.index.subtitle}}</span>
        </div>
        {{#if user.isAuthenticated}}
            <!-- User Activity Stats -->
            <div class="jp-stats-grid" id="userStatsGrid">
                <div class="jp-stat-card">
                    <div class="jp-stat-number" id="lastLogin">-</div>
                    <div class="jp-stat-label">{{i18n.view.user.index.lastLogin}}</div>
                </div>
                <div class="jp-stat-card">
                    <div class="jp-stat-number" id="accountStatus">-</div>
                    <div class="jp-stat-label">{{i18n.view.user.index.accountStatus}}</div>
                </div>
                <div class="jp-stat-card">
                    <div class="jp-stat-number" id="memberSince">-</div>
                    <div class="jp-stat-label">{{i18n.view.user.index.memberSince}}</div>
                </div>
            </div>

            <!-- Dashboard Navigation -->
            <div class="jp-dashboard-grid">
                <a href="/user/profile.shtml" class="jp-card-dashboard jp-icon-btn">
                    <div class="jp-icon-container">
                        {{components.jpIcons.userSvg size="64" _inline=true}}
                    </div>
                    <h3 class="jp-card-title">{{i18n.view.user.index.profileSettings}}</h3>
                    <p class="jp-card-description">{{i18n.view.user.index.profileSettingsDesc}}</p>
                </a>

                <!-- Conditional Admin Dashboard (admin/root only) -->
                {{#if user.isAdmin}}
                <a href="/admin/" class="jp-card-dashboard jp-icon-btn">
                    <div class="jp-icon-container">
                        {{components.jpIcons.configSvg size="64"}}
                    </div>
                    <h3 class="jp-card-title">{{i18n.view.user.index.adminDashboard}}</h3>
                    <p class="jp-card-description">{{i18n.view.user.index.adminDashboardDesc}}</p>
                </a>
                {{/if}}
            </div>
        {{else}}
            <div class="jp-error-box">
                {{i18n.view.auth.common.notAuthenticated}}
            </div>
        {{/if}}
    </div>

    <script>
        {{#if user.isAuthenticated}}
        // Load user dashboard data
        jPulse.dom.ready(() => {
            loadUserStats();
        });
        {{/if}}

        async function loadUserStats() {
            try {
                const result = await jPulse.api.get('/api/1/user');
                if (result.success && result.data) {
                    const user = result.data;

                    // Update last login
                    const lastLoginEl = document.getElementById('lastLogin');
                    if (user.lastLogin) {
                        const date = new Date(user.lastLogin);
                        lastLoginEl.textContent = date.toISOString().split('T')[0]; // YYYY-MM-DD format
                    } else {
                        lastLoginEl.textContent = 'Never';
                    }

                    // Update account status
                    const statusEl = document.getElementById('accountStatus');
                    statusEl.textContent = user.status || 'Unknown';

                    // Update member since
                    const memberSinceEl = document.getElementById('memberSince');
                    if (user.createdAt) {
                        const date = new Date(user.createdAt);
                        memberSinceEl.textContent = date.toISOString().split('T')[0]; // YYYY-MM-DD format
                    } else {
                        memberSinceEl.textContent = 'Unknown';
                    }
                }
            } catch (error) {
                console.error('Failed to load user stats:', error);
            }
        }
    </script>

    {{file.include "jpulse-footer.tmpl"}}
</body>
</html>
